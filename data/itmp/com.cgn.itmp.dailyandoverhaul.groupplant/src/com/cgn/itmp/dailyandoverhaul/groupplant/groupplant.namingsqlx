<?xml version="1.0" encoding="UTF-8"?>
<!-- author:rocan -->
<sqlMap>
    <parameterMap class="commonj.sdo.DataObject" id="parameterMap">
        <parameter javaType="date" jdbcType="DATE" property="dateType"/>
    </parameterMap>
    <resultMap class="commonj.sdo.DataObject" id="resultMap">
        <result column="TYPEID" javaType="string" property="typeId"/>
    </resultMap>
    <select id="getBhInfo" parameterClass="java.lang.String" resultClass="commonj.sdo.DataObject">
    	SELECT top 1 t.bh AS bh FROM (SELECT SUBSTRING(bh,(len(bh)-CHARINDEX('-',REVERSE(bh)) + 2 ),CHARINDEX('-',REVERSE(bh))-1) num,bh,addtime FROM	T_QCJSGL_JYFKHSJGL) t WHERE	DateDiff(dd,t.addtime,getdate()) = 0 ORDER BY	t.addtime DESC,t.num desc
    </select>
           <!--  查询树节点信息 -->
    <select id="qureyTreesInfo" parameterClass="java.util.HashMap" resultClass="commonj.sdo.DataObject">
		SELECT 'root' as parentid,dictid as id,dictname as name from EOS_DICT_ENTRY where dicttypeid = 'ZZ' and dictid = 'JSGLPGZ'
				union all 
		SELECT 'JSGLPGZ' as parentid,dictid as id,dictname as name from EOS_DICT_ENTRY where dicttypeid = 'ZZ' and dictid != 'JSGLPGZ'
    </select>
    
     <!--  综合指数管理统计查询 -->
    <select id="querystatistics" parameterClass="java.lang.String" resultClass="commonj.sdo.DataObject">
		with tmp as (SELECT
			tq.org,
			tq.wd,
			tq.year + '-' + right(cast('0'+rtrim(tq.month) as varchar(3)),2) dates,
			ISNULL(tq.d,0) d,
			ISNULL(tq.h,0) h,
			ISNULL(tq.n,0) n,
			ISNULL(tq.y,0) y,
			ISNULL(tq.t,0) t,
			ISNULL(tq.f,0) f
		FROM
			T_QCJSGL_ZHZSGL tq 
		WHERE
			tq.isdelete = 0)
			select m.dates,sum(m.d) d,sum(m.h) h,sum(m.n) n,sum(m.y) y,sum(m.t) t,sum(m.f) f from tmp m
			<![CDATA[ $params$ ]]>
			GROUP BY m.dates
			order by m.dates
    </select>
    <delete id="deleteTemplate" parameterClass="java.util.Map">
		DELETE FROM T_QCJSGL_JYFKHSJGL_TEMPLATE where jd=#jdid#
	 </delete>
</sqlMap>