<?xml version="1.0" encoding="UTF-8"?>
<!-- author:LENOVO -->
<sqlMap>
    <parameterMap class="commonj.sdo.DataObject" id="parameterMap">
        <parameter javaType="date" jdbcType="DATE" property="dateType"/>
    </parameterMap>
    <resultMap class="commonj.sdo.DataObject" id="resultMap">
        <result column="TYPEID" javaType="string" property="typeId"/>
    </resultMap>
   
    
    
	<select id="getwelders"  parameterClass="java.util.HashMap"  resultClass="commonj.sdo.DataObject">
		 SELECT b.uuid,b.operatingnumber,b.name,b.job,b.authority,b.items,b.initial,b.validity,b.review,a.result as "reviewresult",a.remarks as "reviewremarks" FROM WELDING_RECORD a
left join WELDING_WELDER b on b.uuid=a.identification 
			where  a.welder='1'  
			<isNotNull  prepend =" AND " property="reviewid">
             a.reviewid=#reviewid# 
         </isNotNull>
			<isNotNull  prepend =" AND " property="jd">
             b.JD=#jd#;
         </isNotNull>
			 
	</select>
		<select id="getreminderwelders"  parameterClass="java.util.HashMap"  resultClass="commonj.sdo.DataObject">
		 SELECT b.*,a.result as "reviewresult",a.remarks as "reviewremarks" FROM WELDING_RECORD a,WELDING_WELDER b 
			where b.uuid=a.identification  and a.welder='1'  
			<isNotNull  prepend =" AND " property="ids">
                a.reviewid  in
                <iterate property="ids" conjunction="," open="(" close=")">
                    #ids[]#
                </iterate>
         </isNotNull>
			 
	</select>
	
	<select id="getcertificate"  parameterClass="java.util.HashMap"  resultClass="commonj.sdo.DataObject">
		 SELECT b.cernumber,b.projcode,b.validdate,b.office,b.uuid,a.result as "recordresult",a.remarks as "recordremarks" FROM WELDING_RECORD a,WELDING_CERTIFICATE b
		 where b.uuid=a.identification and  a.reviewid=#reviewid# and a.welder='2' and b.relationid=#welder#  ORDER BY  orderno;
	</select>
	<select id="getworddata"  parameterClass="java.util.HashMap"  resultClass="commonj.sdo.DataObject">
		select record_name,c.name,c.operatingnumber,c.job,c.special,t2.DICTNAME as items,CONVERT(varchar(100),c.initial, 23)as initial,CONVERT(varchar(100),c.validity, 23)as validity,CONVERT(varchar(100),c.review, 23)as review,b.result,b.remarks,
		d.cernumber,d.office,d.projcode,Convert(Char(10),d.validdate,120) as validdate,a.record_person,CONVERT(varchar(100),record_time, 23)as record_time,a.review_person,CONVERT(varchar(100),a.review_time, 23)as review_time,
		(select result from WELDING_RECORD aa where aa.welder=2 and aa.identification=d.uuid and aa.reviewid=a.uuid) as jieguo,
		(select remarks from WELDING_RECORD aa where aa.welder=2 and aa.identification=d.uuid and aa.reviewid=a.uuid) as beizhu
 		from WELDING_REVIEW a 
		LEFT JOIN WELDING_RECORD b  on a.uuid=b.reviewid
		LEFT JOIN WELDING_WELDER c on b.identification=c.uuid 
		LEFT JOIN WELDING_CERTIFICATE d on c.uuid=d.relationid
		LEFT JOIN EOS_DICT_ENTRY t2 ON t2.DICTID = items
			AND t2.DICTTYPEID ='CZXM'
		where a.uuid =#id# and b.welder=1  	
		<isNotNull  prepend =" AND " property="jd">
                c.jd=#jd#
         </isNotNull>
		order by b.uuid	,d.orderno
	</select>
	<select id="getQRword"  parameterClass="java.lang.String"  resultClass="commonj.sdo.DataObject">
		select c.uuid,c.name,c.operatingnumber
 		from WELDING_REVIEW a 
		LEFT JOIN WELDING_RECORD b  on a.uuid=b.reviewid
		LEFT JOIN WELDING_WELDER c on b.identification=c.uuid 
		where a.uuid =#id# and b.welder=1 
	</select>
	
	
</sqlMap>